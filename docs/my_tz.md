
# Task 1
Необходимо создать паралельную сущность CompanyBase, задача которой существовать паралельно с Company, но в CompanyBase будут попадать данные из общих источников (парсинг и т.п.).
  id          Int      @id @default(autoincrement())
  fullName
shortName
status
country и т.д. - смотри справку по данным, которые будут парситься ниже @egr-api.md
email
site

В сущность Company необходимо добавить поля
address и city (в адресе будет дублироваться город, но в этом ничего страшного).

В CourtCase добавить необязательное поле triedToParse

Во избежание ошибок поля выше делай необязательными.

В сущности contactperson необходимо добавить необязательное поле source, которое при парсинге в данном случае заполняется как ЕГР.
В сущностях smstemplate emailtemplate необходимо добавить channelcategory, а также создать саму сущность channelСategory.


При необходимости добавь новые поля в edit detail index nuxt-app\app\pages\panel

# Task 2
Теперь реализуем поиск по части имени

Смотри справку по функции @egr-api.md

Обрати внимание, что запрос обрабатывается долго, если сервер недоступен, то очередь прекращается, выводится flash-message (если окно запуска еще открыто).

Из этого запроса в сущность companyBase сохраняются фирмернное наименование "vfn", УНП (ngrn), Статус vnsostk, полное наименование vnaim, короткое наименование vn и одновременно сохраняются данные в сущность Company краткое наименование в name, остальные имена в массив aliases. 

При успешном ответе сервера (независимо  от результативности следующей задачи) в triedToParse CourtClaim писать true.

Если найдена 1 сущность, то сущность из CourtCase (debtorCompany или claimantCompany ) связывается с этой компанией и выполняется следующий запрос поиск контактнтых данных getAddressByRegNum (справка по api @egr-api.md, #Поиск по УНП контактных данных, https://egr.gov.by/api/v2/egr/getAddressByRegNum/{regNum})

Если в court-cases сохраняется новое debtorId company, то наименование должника из court-cases добавляется в aliases для компаний.

Особенности для внедрения - ngrn = {regNum}  - это уникальное поле
Данные адреса необходимо составить в одну строку, например, для примера ниже
220007, Минск, Фабрициуса, 7-12.

Телефон для CompanyBase оставлять как есть, а для Company необходимо создать ContactPerson с именем "Общий", телефон прикреплять в связанные сущности Phone, Email, телефон преобразовать в формат 375447022404 (убрать плюс, пробелы, скобки, если несколько телефонов через запятую - создать несколько Phone), сайт сохранять как есть и в CompanyBase и в model Company (сюда в схему добавить такое свойство).

Если данные есть, то  то в таблице CompanyBase обновляются, а в Phone Email (если эти поля изменились), добавляется новая сущность ContactPerson, а ранее существовавший ContactPerson со значением "Общий" меняется флаг isDeleted.


Создай  здесь @nuxt-app\app\pages\panel\egr отдельные внутренние api-эндпоинт с доступом только из других эндпоинтов (при необходимости создай nuxt-app\app\middleware)

# Task 3
На @nuxt-app\app\pages\panel\court-cases\index.vue под названием компании необходимо выводить унп соотнесенной компании, а если компаний нет, то красным писать Не найдена. 

На @nuxt-app\app\pages\panel\court-cases\[id]\edit.vue поиск в базе необходимо производить только после ввода не менее 4 чисел или цифр по унп, названию. В поиске выводить название, унп,первые 20 букв адреса.

# Task 4
На странице @nuxt-app\app\pages\panel\court-cases\[id]\edit.vue рядом с кнопкой подробнее для debtorCompany и caseNumber  сделай кнопку поиск по УНП, которая заполняется, только если компания не заполнена). При нажатии на эту кнопку во всплывающем окне появляется окно ввода УНП (9 цифр с валидацией) и кнопка найти. При клике на эту кнопку обращается к api (его необходимо создать), который в свою очередь обращается к внутреннему api-эндпоинту, созданному в задаче 2 и выполняет эти действия. По выполнении действия - flash-message (найдено или ошибка), а если найдена одна компания - соотнести ее и выполнить задачи из пункта 2.


# Task 5
На странице @nuxt-app\app\pages\panel\court-cases\index.vue необходимо добавить кнопку поиск ответчиков, а также создать бэкэнд api для этой задачи, кнопка отображается спинером, пока работает задача.

Т.к. задача трудоемкая, то должен возвращаться ответ с предложением вернуться на страницу минут через 5 и задача будет выполняться это время в фоне.
Парсинг по API с задержкой 1 секунда.
Поиск осуществляется в отношении сущностей, отображенных на странице, только в отношении поиска debtorCompany, обрати внимание, что в других CourtCase уже мог быть этот debtorCompany. Алгоритм поиска записан в разделе 2 плана внедрения.

Если 2 раза сервер не смог отдать данные, то возвращается ошибка, поиск прекращается.

Точно также в каждой строке добавь кнопку поиск сторон, но при клике на нее поиск должен осуществляться как для debtorCompany, так и claimantCompany, во flash-message должно появляеться сообщение о найденной информации.


# Task 6
Создай новую сущность messageChain, которая будет включать в себя цепочки для emailtemplate и для smstemplate, продумай сам схему. Продумай схему, т.к. пользователю необходимо будет иметь возможность выбирать несколько emailtamplate или smstemplate, указывать дни направления от даты создания (+2 дня, + 5 дней, + 10 дней)

Необходимо создать crud для emailtemplate smstemplate messageChain без пагинации (см. crud - app/pages api/panel для других сущностей, можешь на примере @nuxt-app\app\pages\panel\users).

#  Task 7

Доработай сущности SentEmail SentSms добавь 
  externalId  String?
  status
  channel

  Сделай index page для разосланных сообщений (2 разных сущности) по аналогии с nuxt-app\app\pages\panel\companies\index.vue с пагинацией

По примеру  @nuxt-app\server\utils\egr.ts сделай функции по работе с @docs\sms-api.md, @docs\email-api.md при этом в будущем отправка сообщений будет работать через BullMQ (Redis), а сохранение отправленных в текущей базе.

#  Task 8
Для бэкэнда серверной части мне нужна очередь, установи, например, bullMQ, подключи и настрой, т.к. часть задач по рассылке сообщений будет работать в бэкграунде.


nuxt-app\server\utils



#  Task 9